---
//import NavUtilities from './NavUtilities.astro';
import '../styles/global.scss';
import logo from '../assets/olj_logo.png';
---

<nav class="navbar navbar-expand-lg navbar-light custom-navbar">
    <div class="nav-container container">
        <!-- Logo on the left -->
        <a class="navbar-brand custom-navbar-brand" href="/">
            <img src={logo.src} alt="Logo" />
        </a>

        <!-- Toggle button for mobile view -->
        <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarMain"
            aria-controls="navbarMain"
            aria-expanded="false"
            aria-label="Toggle navigation"
        >
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Nav links -->
        <div class="collapse navbar-collapse custom-navbar-collapse" id="navbarMain">
            <ul class="navbar-nav ms-auto custom-navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="/">Home</a>
                </li>
                <li class="nav-item dropdown">
                    <a
                        class="nav-link dropdown-toggle"
                        href="#"
                        data-bs-toggle="dropdown"
                        role="button"
                        aria-expanded="false"
                    >
                        Adventures &amp; Tours
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <a class="dropdown-item" href="/itinerary/1/family-japan-adventure/"
                                >Japan Family Bike Adventure</a
                            >
                        </li>
                        <li>
                            <a class="dropdown-item" href="/itinerary/5/autumn-hike-and-bike-adventure/"
                                >Autumn Bike &amp; Hike</a
                            >
                        </li>
                        <li>
                            <a class="dropdown-item" href="/itinerary/4/3-days-off-the-path/"
                                >Three Day Rural Immersion</a
                            >
                        </li>
                        <li>
                            <a class="dropdown-item" href="/itinerary/2/rural-japan-walk-and-photo-tour/"
                                >Rural Japan Photography Walk</a
                            >
                        </li>
                        <li><hr class="dropdown-divider" /></li>
                        <!-- Nested submenu for Custom Adventures -->
                        <li class="dropdown-submenu">
                            <a class="dropdown-item main-item" href="/itinerary/7/custom-wanderlust/"
                                >Custom Itineraries ››</a
                            >
                            <ul class="dropdown-menu">
                                <li>
                                    <a class="dropdown-item" href="/itinerary/8/one-month-across-japan/"
                                        >One Month Across Japan</a
                                    >
                                </li>
                                <li>
                                    <a class="dropdown-item" href="/itinerary/9/one-week-in-noto/"
                                        >10 Days Kanazawa &amp; Noto</a
                                    >
                                </li>
                                <li>
                                    <a class="dropdown-item" href="/itinerary/10/5-days-biwako-wakasa-coast/"
                                        >5 Days Biwako &amp; Wakasa Coast</a
                                    >
                                </li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li class="nav-item"><a class="nav-link" href="/self-guided/">Self-Guided</a></li>
                <li class="nav-item"><a class="nav-link" href="/about/">About</a></li>
                <li class="nav-item"><a class="nav-link" href="/contact/">Contact</a></li>
                <li class="nav-item"><a class="nav-link" href="/journeys/">Blog</a></li>
            </ul>
        </div>
    </div>
</nav>

<style lang="scss">
    @use '../styles/global' as *;

    /* Base navbar styles */
    .custom-navbar {
        padding: 0 !important;
    }

    .custom-navbar-brand {
        display: flex;
        align-items: stretch;
    }

    .custom-navbar-brand img {
        height: 100%;
        object-fit: contain;
        width: 226px;
        transition: width 0.3s ease;
    }

    @include respond-to(large) {
        .custom-navbar-brand img {
            width: 175px;
        }
    }

    .custom-navbar-nav {
        padding: 0;
        margin-bottom: 0;
    }

    .nav-link {
        color: var(--primary-color);
        font-weight: 500;
        &:hover,
        &:focus {
            color: var(--bs-primary-dark) !important;
        }
    }

    .dropdown-menu {
        background-color: var(--bs-light);
        .dropdown-item {
            color: var(--bs-link-color) !important;
            border-bottom: 1px solid #e0e0e0;
        }
    }

    .navbar a {
        color: var(--bs-link-color);
        font-size: 1.2em;
    }
    .navbar a:hover {
        color: var(--bs-link-hover-color);
    }
    .nav-item {
        border-right: 1px solid var(--bs-link-hover-color);
    }
    .nav-item:last-child {
        border-right: 0;
    }

    /* Mobile adjustments */
    @media (max-width: $large-screen) {
        .custom-navbar {
            max-width: 100% !important;
            margin: 0;
            padding: 0;
        }
        .custom-navbar-nav {
            margin-left: 0 !important;
            width: 100%;
        }
        .nav-item {
            border-bottom: 1px solid #e0e0e0;
            border-right: 0;
        }
    }
    @media (max-width: $small-screen) {
        .nav-container.scrolled {
            //padding-top: 30px;
            //border: 1px solid red;
        }
    }
    /* Fixed navbar styling with transition */
    .navbar {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 2000; /* High z-index to cover content */
        background: #fff;
        border-bottom: 1px solid var(--bs-link-hover-color);
        transition: transform 0.3s ease;
    }

    /* When hidden, slide it up out of view */
    .navbar.hidden-nav {
        transform: translateY(-100%);
    }
    .main-item {
        font-weight: 900;
        color: var(--bs-link-color);
        //background: var(--bs-link-color-opaque);
    }

    /* Make nested dropdown menu always visible */
    .dropdown-submenu .dropdown-menu {
        display: block; /* Always display the submenu */
        position: static; /* Remove any absolute positioning */
        margin-left: 15px; /* Indent to visually group under the main item */
        //border-left: 2px solid #ccc; /* Optional: Visual separator */
    }
    .dropdown-submenu .dropdown-menu ul {
        border-top: 0px solid #ccc; /* Optional: Visual separator */
        border-left: 0px solid #ccc; /* Optional: Visual separator */
        border-right: 0px solid #ccc; /* Optional: Visual separator */
    }
    .dropdown-submenu li {
        border: 0px;
    }

    /* Nested submenu for Custom Adventures should be indented only, with no box */
    .dropdown-submenu .dropdown-menu {
        display: block; /* Always display the submenu */
        position: static; /* Remove any absolute positioning */
        margin-left: 15px; /* Indent the submenu */
        background: transparent; /* Remove the background */
        border: none; /* Remove any borders */
        box-shadow: none; /* Remove any shadow */
        padding: 0; /* Remove extra padding, if any */
    }

    /* Optionally, adjust the individual submenu items */
    .dropdown-submenu .dropdown-menu .dropdown-item {
        background: transparent; /* Ensure items are transparent */
        border: none; /* Remove item borders */
        padding-left: 15px; /* Optionally add extra left padding for text */
        /* You can also adjust font-size, color, etc., if needed */
    }
</style>

<!-- JavaScript: Hide navbar on scroll down, show on scroll up -->
<script>
    let doHideNav = true;
    doHideNav = false;

    document.addEventListener('DOMContentLoaded', function () {
        let lastScrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const mainNav = document.querySelector('.navbar');
        const navbarToggler = document.querySelector('.navbar-toggler');
        let isMenuOpen = false;
        const delta = 5; // Threshold for downward scroll

        function handleScroll() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

            // Only run scroll logic if the mobile menu is not open
            if (!isMenuOpen) {
                if (scrollTop - lastScrollTop > delta) {
                    // Scrolling down: add class to hide the navbar
                    doHideNav && mainNav!.classList.add('hidden-nav');
                } else if (lastScrollTop - scrollTop > 0) {
                    // Scrolling up: remove class so the navbar reappears
                    mainNav!.classList.remove('hidden-nav');
                }
            }
            lastScrollTop = scrollTop;
        }

        window.addEventListener('scroll', handleScroll);

        // When the hamburger menu is toggled, ensure the navbar stays visible
        if (navbarToggler) {
            navbarToggler.addEventListener('click', function () {
                isMenuOpen = !isMenuOpen;
                if (isMenuOpen) {
                    mainNav!.classList.remove('hidden-nav');
                }
            });
        }
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const navContainer = document.querySelector('.nav-container');
        function handleScroll() {
            if (window.scrollY > 0) {
                navContainer!.classList.add('scrolled');
            } else {
                navContainer!.classList.remove('scrolled');
            }
        }

        window.addEventListener('scroll', handleScroll);
    });
</script>
