---
//export const prerender = true;
---

<!-- Contact Page Markup -->
<style>
    .center {
        text-align: center;
        font-weight: 900;
        color: var(--bs-link-color);
        margin: 30px;
    }

    ul.questions li {
        margin-bottom: 10px;
    }

    /* Contact Form Container */
    #contactForm {
        max-width: 600px; /* Constrain the width */
        margin: 2rem auto; /* Center on the page with vertical spacing */
        padding: 1.5rem; /* Internal padding */
        background: #f8f9fa; /* Light background (Bootstrapâ€™s light gray) */
        border: 1px solid #dee2e6; /* Subtle border */
        border-radius: 0.25rem; /* Slightly rounded corners */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    /* Form Fields */
    #contactForm input,
    #contactForm textarea {
        margin-bottom: 1rem;
    }

    /* Submit Button */
    #contactForm button[type='submit'] {
        display: block;
        width: 100%;
        margin-top: 1rem;
    }

    /* Form Response Message */
    #formResponse {
        max-width: 600px;
        margin: 1rem auto;
        padding: 1rem;
        text-align: center;
        font-weight: bold;
        background: #e9ecef;
        border: 1px solid #ced4da;
        border-radius: 0.25rem;
    }
</style>

<h2 class="mb-4">Inquire About an Adventure</h2>

<p>
    To enquire about a trip, please contact us via email with the dates and type of itinerary you are interested in, as
    well as any other information that will be helpful for us to develop the perfect adventure for you.
</p>
<p class="center"><a href="mailto:info@onelifejapan.com">info@onelifejapan.com</a></p>
<ul class="questions">
    <li>Participant Names, Ages & General desired activity level</li>
    <li>Which itinerary on the site is closest to your goals?</li>
    <li>How long will you be in Japan before and after your trip with One Life Japan?</li>
    <li>What places will you visit before and after?</li>
    <li>How often/far do you walk, ride a bike or hike?</li>
    <li>Do you have any physical conditions/concerns you would like us to consider?</li>
    <li>Do you have any special requirements for accommodations?</li>
    <li>Do you have any specific dietary restrictions or allergies?</li>
</ul>

<form id="contactForm">
    <input type="text" name="name" placeholder="Your Name" required />
    <input type="email" name="email" placeholder="Your Email" required />
    <textarea name="message" placeholder="Your Message" required></textarea>

    <!-- Honeypot field: hidden from users -->
    <div style="display:none;">
        <label for="honeypot">Leave this field blank</label>
        <input type="text" name="honeypot" id="honeypot" />
    </div>

    <button type="submit">Send</button>
</form>

<div id="formResponse"></div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Record the time when the form is rendered
        const formRenderTime = Date.now();
        // Flags to track user interaction
        let userTyped = false;
        let userPasted = false;

        // Attach event listeners to all input and textarea fields
        const formFields = document.querySelectorAll('#contactForm input, #contactForm textarea');
        formFields.forEach((field) => {
            // On any user input, mark that typing occurred
            field.addEventListener('input', () => {
                userTyped = true;
            });
            // Check for pasting; this flag is separate in case the user copies and pastes
            field.addEventListener('paste', () => {
                userPasted = true;
            });
        });

        // AJAX submission
        const form = document.getElementById('contactForm');
        const responseContainer = document.getElementById('formResponse');

        form.addEventListener('submit', async (event) => {
            event.preventDefault();

            // Calculate elapsed time in seconds since the page loaded
            const elapsedTime = (Date.now() - formRenderTime) / 1000;

            // Create FormData from the form
            const formData = new FormData(form);
            // Append extra data: elapsedTime and flags indicating if the user typed and/or pasted
            formData.append('elapsedTime', elapsedTime);
            formData.append('userTyped', userTyped ? 'true' : 'false');
            formData.append('userPasted', userPasted ? 'true' : 'false');

            try {
                // Send AJAX POST request
                const response = await fetch('https://my.onelifejapan.com/www/api/contact.php', {
                    method: 'POST',
                    body: formData,
                });

                // Expect JSON response from the server
                const json = await response.json();
                console.log('json');
                console.log(json);
                if (response.ok && json.success) {
                    responseContainer.innerText = json.message || 'Thank you! Your message has been sent.';
                    form.reset();
                } else {
                    responseContainer.innerText = json.message || 'Submission error. Please try again.';
                }
            } catch (error) {
                console.error('Error submitting form:', error);
                responseContainer.innerText = 'An error occurred. Please try again later.';
            }
        });
    });
</script>
