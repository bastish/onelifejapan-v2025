---
// Fetch grouped post data from the custom WordPress REST API endpoint
const response = await fetch('https://blog.onelifejapan.com/wp-json/custom/v1/year-month-counts');
if (!response.ok) {
    throw new Error(`Failed to fetch year-month counts: ${response.statusText}`);
}

// Grouped data by year and month from the API
const groupedPosts = await response.json();
---

<div class="archive-links">
    <h3>Archives</h3>
    <ul id="archive-list">
        {Object.keys(groupedPosts)
            .sort((a, b) => parseInt(b) - parseInt(a)) // Sort years descending
            .map((year) => (
                <li>
                    <button class="year-toggle" data-year={year}>
                        {year}
                    </button>
                    <ul class="month-list" id={`months-${year}`} style="display: none;">
                        {groupedPosts[year]
                            .sort((a, b) => new Date(`1 ${a.month}`).getMonth() - new Date(`1 ${b.month}`).getMonth()) // Sort months ascending
                            .map(({ month, count }) => (
                                <li class="archive-month" key={`${year}-${month}`}>
                                    <a href={`/journeys/archive/${String(year)}/${String(month).toLowerCase()}/`}>
                                        {month} ({count})
                                    </a>
                                </li>
                            ))}
                    </ul>
                </li>
            ))}
    </ul>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const toggles = document.querySelectorAll('.year-toggle');
        toggles.forEach((toggle) => {
            toggle.addEventListener('click', function () {
                const year = this.dataset.year;
                const monthList = document.getElementById(`months-${year}`);

                if (monthList && monthList.style.display === 'none') {
                    monthList.style.display = 'block';
                } else if (monthList) {
                    monthList.style.display = 'none';
                }
            });
        });
    });
</script>

<style>
.archive-links {
    font-family: Arial, sans-serif;
}

.year-toggle {
    background: none;
    border: none;
    cursor: pointer;
    text-align: left;
    font-weight: bold;
    width: 100%;
}

.year-toggle:hover {
    text-decoration: underline;
}

.month-list {
    margin: 0;
    padding: 0 0 0 16px;
    list-style: none;
}
</style>
