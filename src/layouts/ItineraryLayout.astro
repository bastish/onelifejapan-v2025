---
import HeadComponent from '../components/Head/HeadComponent.astro';
import TopNav from '../components/TopNav/TopNav.astro';
import Footer from '../components/Footer/Footer.astro';
import BottomBanner from '../components/BottomBanner.astro';
import ItineraryCardList from '../components/ItineraryCardList.astro';
import PurchaseBlock from '../components/PurchaseBlock.astro';
import GenericSlider from '../components/GenericSlider.astro';
import ItineraryBasicInfo from '../components/ItineraryBasicInfo.astro';
//import ItinerarySampleItineraryDay from '../components/ItinerarySampleItineraryDay.astro';
import ItinerarySampleItinerarySection from '../components/ItinerarySampleItinerarySection.astro';
import ItineraryPossibleHighlights from '../components/ItineraryPossibleHighlights.astro';
import ItineraryDifficulty from '../components/ItineraryDifficulty.astro';
import ItineraryPricingDetails from '../components/ItineraryPricingDetails.astro';
import ItineraryDatesAndAvailability from '../components/ItineraryDatesAndAvailability.astro';
//import CustomItineraryCollapsibleChecklist from '../components/CustomItineraryCollapsibleChecklist.astro';
//import CustomItinerary from '../components/CustomItinerary.astro';
import ItinerarySectionContainer from '../components/ItinerarySectionContainer.astro';
import background from '../assets/background.svg';
import '../styles/global.scss';

const id = Astro.props.id;
import { loadItinerary } from '../utils/loadItinerary.ts';
import { loadCustomItinerary, customItineraryList } from '../utils/loadCustomItinerary';
let itinerary = await loadItinerary(id);

// // astro-dynamic-embed

import { AstroEmbedComponents, embedComponents } from '../astroEmbedComponent/astroEmbedComponents';
let aecComponents: any[] = [];
[aecComponents, itinerary] = embedComponents(aecComponents, itinerary);

const {
    title,
    description
} = itinerary;

let page = 'itinerary';
let customItineraries = null;
let customClass = '';

if (itinerary.id === 7) {
    page = 'customIndex';
    customItineraries = await customItineraryList();
    customClass = 'is-custom';
}
---

<!doctype html>
<html lang="en">
    <head>
        <HeadComponent title={title} description={description} />
        <slot name="head" />
    </head>
    <body>
        <img id="background" src={background.src} alt="" fetchpriority="high" />

        <div class="custom-container">
            <TopNav />
        </div>

        <div>
            {itinerary.sliderImage ? <GenericSlider sliderImageId={itinerary.sliderImage.id} height={175} /> : <div />}
        </div>

        <div class="custom-container itinerary-main">   

            <ItinerarySectionContainer>
                <PurchaseBlock page={page} itinerary={itinerary} />
            </ItinerarySectionContainer>        
            

            <ItinerarySectionContainer sectionTitle="" sectionAnchorId="basic-info">
                {
                    page === 'customIndex' ? (
                        <div
                            set:html={itinerary.longDescription}
                            class="formatted-long-description custom-top"
                            style="margin-top: 100px margin-bottom: 10px;"
                        />
                    ) : (
                        <ItineraryBasicInfo itinerary={itinerary} />
                    )
                }
            </ItinerarySectionContainer>
            
            
            <ItineraryCardList itineraries={customItineraries} page={page} />


            <!-- Days Section -->
            {page === 'customIndex' ? <></> : 
                <ItinerarySectionContainer sectionTitle="A Sample Itinerary" sectionAnchorId="sample-itinerary">
                    <ItinerarySampleItinerarySection itinerary={itinerary} />
                </ItinerarySectionContainer>
            }

            <!-- Hihglights Section -->
            {page === 'customIndex' ? <></> :
                <ItinerarySectionContainer sectionTitle="Possible Highlights" sectionAnchorId="possible-highlights">
                    <ItineraryPossibleHighlights itinerary={itinerary} />
                </ItinerarySectionContainer>
            }

                        
            <!-- Difficulty Section -->
            <ItinerarySectionContainer sectionTitle="Difficulty" sectionAnchorId="difficulty">
                    <ItineraryDifficulty itinerary={itinerary} />
            </ItinerarySectionContainer>
            
            <!-- Price Section -->
            <ItinerarySectionContainer sectionTitle="Price Estimates" sectionAnchorId="pricing-details">
                <ItineraryPricingDetails itinerary={itinerary} />
            </ItinerarySectionContainer>

            <!-- Dates Section -->
            <ItinerarySectionContainer sectionTitle="Dates & Availability" sectionAnchorId="dates-and-availability">
                <ItineraryDatesAndAvailability itinerary={itinerary} />
            </ItinerarySectionContainer>

        </div>

        <!-- <BottomBanner /> -->
        <Footer />

        <AstroEmbedComponents aecComponents={aecComponents} />
    </body>
</html>

<style lang="scss">
    @import '../styles/global.scss';

    .itinerary-main {
        padding: 0px;
        margin-top: 20px;
        //border: 1px solid green;
    }

    .page-section {
        padding-bottom: 175px;
    }
    .page-section.is-custom {
        padding-bottom: 0px !important;
    }

    .headline,
    .short-slogan,
    .inner-headline {
        text-align: center;
    }
    .headline {
        padding-top: 20px;
    }
    .inner-headline {
        padding-top: 5px;
        margin-bottom: 0px;
    }

    .short-slogan {
        font-size: 1.3em;
        padding: 20px;
        font-weight: normal;
        /* color: var(--bs-primary-dark);
    color: var(--bs-primary); */
    }
    .itinerary-fixed-nav {
        position: relative;
        z-index: 1030;
        background: #fff;
        padding-top: 0px; /* Top padding when fixed */
    }
    .itinerary-fixed-nav::before,
    .itinerary-fixed-nav::after {
        content: '';
        position: absolute;
        left: 0;
        right: 0;
        height: 1px;
        background: #ddd;
        width: 100vw; /* Full width of the viewport */
        margin-left: -50vw; /* Offset half the viewport width to align */
        left: 50%; /* Start at the middle of the viewport */
    }
    .itinerary-fixed-nav::before {
        top: 0;
    }
    .itinerary-fixed-nav::after {
        bottom: 0;
    }
    .is-fixed {
        position: fixed;
        top: 75px; /* Adjust this based on your main navbar's height */
        top: 0;
        width: 100%;
        background: #fff; /* Ensures background is applied */
        transition: top 0.3s ease; /* Smooth transition for the top property */
    }
    .inner-container {
        max-width: 1200px; /* Adjust based on your container width */
        margin: 0 auto;
        padding: 0 15px; /* Optional padding */
    }

    .section-inner {
        border: 1px solid #ddd;
        background: var(--opaque-white-8);
        background: var(--opaque-primary-mid);

        padding-left: 20px;
        padding-right: 20px;
        padding-top: 20px;
    }

    @include respond-to(medium) {
        .section-inner {
            padding-left: 5px;
            padding-right: 5px;
        }
    }

    @include respond-to(small) {
        .is-fixed {
            position: unset;
        }
        .page-section {
            padding-bottom: 25px;
        }
    }

    .secondary-header {
        // background: var(--bs-primary-ultralight);
        // background: var(--bs-primary-dark);
        padding: 0px;
        padding-left: 0px;
        //border: 1px solid var(--bs-primary);
        border-bottom: 2px solid var(--bs-primary);
        border-radius: 5px 5px 0px 0px;
    }
    .secondary-header h2 {
        /* text-transform: uppercase; */
        font-weight: 555;
        letter-spacing: 0.03em;
        color: #fff;
        color: var(--bs-primary-dark);
        margin-left: 0px;
        padding-left: 0px;
        font-size: 1.9em;
        //border: 1px solid red;
        margin-bottom: 10px;
    }
    @media (max-width: 576px) {
        .secondary-header {
            padding-left: 10px;
            padding-right: 10px;
        }
        .add-padding-for-small {
            padding-left: 10px;
            padding-right: 10px;
        }
    }
</style>
